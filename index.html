<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />



  <link rel="icon" type="image/png" sizes="32x32" href="https://sfault-avatar.b0.upaiyun.com/206/579/2065794108-5721d3ee75b36_huge256?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="https://sfault-avatar.b0.upaiyun.com/206/579/2065794108-5721d3ee75b36_huge256?v=5.1.3">






  <meta name="keywords" content="java,linux,python,cloud" />





  <link rel="alternate" href="/atom.xml" title="倚楼听风雨" type="application/atom+xml" />






<meta name="description" content="青苔边，折梅不赏;古道旁，煮酒不饮。">
<meta property="og:type" content="website">
<meta property="og:title" content="倚楼听风雨">
<meta property="og:url" content="http://xbynet.top/index.html">
<meta property="og:site_name" content="倚楼听风雨">
<meta property="og:description" content="青苔边，折梅不赏;古道旁，煮酒不饮。">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="倚楼听风雨">
<meta name="twitter:description" content="青苔边，折梅不赏;古道旁，煮酒不饮。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://xbynet.top/"/>





  <title>倚楼听风雨</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?9f9e6e9198259e7a598474c9df6397dc";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">倚楼听风雨</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">淡看江湖路</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-相册">
          <a href="/photos/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            相册
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>

<script>
    (function(){
        if(''){
            if (prompt('请输入文章密码') !== ''){
                alert('密码错误！');
                history.back();
            }
        }
    })();
</script>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xbynet.top/2018/01/19/数据库知识回顾之理论基础/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xbynet">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://sfault-avatar.b0.upaiyun.com/206/579/2065794108-5721d3ee75b36_huge256">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="倚楼听风雨">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/19/数据库知识回顾之理论基础/" itemprop="url">数据库知识回顾之理论基础</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据库/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/01/19/数据库知识回顾之理论基础/" class="leancloud_visitors" data-flag-title="数据库知识回顾之理论基础">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">热度&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  6,509
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  25
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <script src="\assets\js\APlayer.min.js"> </script><h1 id="范式-NF"><a href="#范式-NF" class="headerlink" title="范式(NF)"></a>范式(NF)</h1><p>参考：<a href="https://www.zhihu.com/question/24696366" target="_blank" rel="noopener">https://www.zhihu.com/question/24696366</a></p>
<p><strong>范式(NF)</strong>:一张表的表结构所符合的某种设计标准的级别。目前有1NF，2NF,3NF,BCNF(一般到3NF,BCNF就够了),4NF,5NF.符合高一级范式设计，必定符合低一级范式。<br>注意：现在很多互联网企业在大数据量的情况下，由于不希望关联查询带来的复杂性和开销，采用反范式设计或甚至直接采用NOSQL数据库。</p>
<p>关系模式和关系：你可以简单的理解关系模式就是数据表结构，而关系就是存有数据的数据表。</p>
<p><strong>函数依赖</strong>：若在一张表中，在属性（或属性组）X的值确定的情况下，必定能确定属性Y的值，那么就可以说Y函数依赖于X，写作 X → Y<br><strong>完全函数依赖</strong>:在一张表中，若 X → Y，且对于 X 的任何一个真子集（假如属性组 X 包含超过一个属性的话），X ‘ → Y 不成立，那么我们称 Y 对于 X 完全函数依赖,记作 X F→ Y。<br><strong>部分函数依赖</strong>:假如 Y 函数依赖于 X，但同时 Y 并不完全函数依赖于 X，那么我们就称 Y 部分函数依赖于 X，记作 X  P→ Y<br><strong>传递函数依赖</strong>:假如 Z 函数依赖于 Y，且 Y 函数依赖于 X,即:若X-&gt;Y,Y-&gt;Z （Y 不包含于 X，且 X 不函数依赖于 Y』这个前提），那么我们就称 Z 传递函数依赖于 X ，记作 X T→ Z<br><strong>码</strong>:设 K 为某表中的一个属性或属性组，若除 K 之外的所有属性都完全函数依赖于K，那么我们称 K 为候选码，简称为码。<br><strong>主属性与非主属性</strong>:包含在任何一个码中的属性成为主属性。其他则是非主属性</p>
<p><strong>1NF</strong>:符合1NF的关系中的每个属性都不可再分。下表所示，就不符合1NF的要求：<br><img src="/img/2018-01-19-16-19-24.png" alt=""><br>下面是符合1NF的情形：<br><img src="/img/2018-01-19-16-20-18.png" alt=""><br>1NF是所有关系型数据库的最基本要求，所以由关系数据库创建表的时候就给予保证了。</p>
<p>但是仅仅符合1NF的设计，会存在<strong>数据冗余过大，插入异常，删除异常，修改异常</strong>的问题。</p>
<p><strong>2NF</strong>:2NF在1NF的基础之上，消除了<strong>非主属性</strong>对于码的<strong>部分</strong>函数依赖。判断标准：是否存在非主属性对于码的部分函数依赖，若存在，则不满足2NF。<br>步骤：<br>第一步：找出数据表中所有的码。<br>第二步：根据第一步所得到的码，找出所有的主属性。<br>第三步：数据表中，除去所有的主属性，剩下的就都是非主属性了。<br>第四步：查看是否存在非主属性对码的部分函数依赖。</p>
<p>2NF可以肯定地说会减少数据冗余，但对插入异常，删除异常，修改异常因不同情况满足一个或多个。知乎的例子中，2NF消除了修改异常，但并没有消除删除，插入异常。</p>
<p>2NF通俗地说就是一个大表拆分为小表的过程。</p>
<p><strong>3NF</strong>: 3NF在2NF的基础之上，消除了<strong>非主属性</strong>对于码的<strong>传递函数依赖</strong>。也就是说， 如果存在非主属性对于码的传递函数依赖，则不符合3NF的要求。<br>如：对于学生表，主码为学号，主属性为学号，非主属性为姓名、系名和系主任。因为 学号 → 系名，同时 系名 → 系主任，所以存在非主属性系主任对于码学号的传递函数依赖，所以学生表的设计，不符合3NF的要求。<br>3NF可以进一步减少数据冗余，也能消除部分异常，如知乎的例子就消除了删除，插入异常。<br>一般而言设计到3NF就够了。不过再强调一遍：<br><code>注意：现在很多互联网企业在大数据量的情况下，由于不希望关联查询带来的复杂性和开销，采用反范式设计或甚至直接采用NOSQL数据库。</code></p>
<p><strong>BCNF</strong>: 3NF 的基础上消除<strong>主属性</strong>对于码的<strong>部分与传递</strong>函数依赖。也就是说不符合BCNF的情形必定存在多个码。而符合BCNF的情形不存在<strong>主属性</strong>对于码的部分函数依赖与传递函数依赖。</p>
<h1 id="数据库系统概念笔记"><a href="#数据库系统概念笔记" class="headerlink" title="数据库系统概念笔记"></a>数据库系统概念笔记</h1><p>资料：数据库系统概念-第6版-PDF<br>架构图：<br><img src="/img/2018-01-19-17-11-19.png" alt=""></p>
<p>数据库管理系统（DBMS）由一个互相关联的数据的集合和一组用以访问这些数据的程序组成。<br>数据由DBMS统一管理和控制。为了保证数据的并发共享，DBMS必须提供数据安全性（Security）保护、数据完整性（Integrity）检查、并发（Concurrency）控制、数据库恢复（Recovery）等功能。<br>数据抽象/三级模式：</p>
<ul>
<li>物理层  最低层次的抽象。描述数据实际上是怎样存储的，详细描述复杂的底层数据结构；</li>
<li>逻辑层  比物理层稍高的抽象，描述数据库中存储什么及这些数据间存在什么关系。逻辑层的用户不必知道物理层的复杂性，这称作物理数据独立性；</li>
<li>视图层  最高层次的抽象，只描述整个数据库的某个部分</li>
</ul>
<p>模式(Schema)和实例(instance)：因为随着事件的推移，数据库会发生增删改，数据库会发生改变。特定时刻存储在数据库中的信息的集合就称作数据库的一个实例，而数据库的总体设计就称作数据库模式。这里要注意，数据库昨天的实例和今天的实例可能是不一样的。</p>
<p>数据模型：<br>3要素：<br>①、数据结构，描述数据库的组成对象和对象间的联系。如层次模型、网状模型和关系模型。<br>②、数据操作，对数据库中各种对象的实例允许的操作集合。<br>③、数据的完整性约束条件，保证数据的正确、有效、相容。</p>
<p>E-R图：</p>
<ul>
<li>实体集用<strong>矩形</strong>标识</li>
<li><strong>椭圆</strong>形表示实体集的属性</li>
<li>关系集用连接一对相关的实体集的<strong>菱形</strong>表示，联系名放在菱形内部。<br><img src="/img/2018-01-19-17-28-43.png" alt=""><br>练习参考：<a href="https://www.cnblogs.com/zpfbuaa/p/5256187.html" target="_blank" rel="noopener">https://www.cnblogs.com/zpfbuaa/p/5256187.html</a></li>
</ul>
<p><strong>存储管理器</strong>实现了几种数据结构，作为系统物理实现的一部分：</p>
<ul>
<li>数据文件，存储数据库自身；</li>
<li>数据字典，存储关于数据库结构的元数据，尤其是数据库模式；</li>
<li>索引，提供对数据项的快速访问。</li>
</ul>
<p>数据挖掘与信息检索：</p>
<ul>
<li>数据挖掘指的是半自动地分析大型数据库并从中找出有用的模式的过程。</li>
<li>与关系数据库中严格的结构化数据不同，查询非结构化的文本数据被称为信息检索。</li>
<li>信息系统领域与数据库系统所强调的重点是不同的，信息系统重点强调基于关键词的查询，文档与查询的相似度，以及文档的分析、分类和索引。</li>
</ul>
<p><strong>事务</strong>：是用户定义的一个数据库操作序列，这些操作要么全做，要么全不做，是一个不可分割的工作单位;事务是恢复和并发控制的基本单位.<br>事务的<strong>ACID</strong>特性：原子性（Atomicity）一致性（Consistency）隔离性（Isolation）持续性（Durability ）<br><strong>并发控制</strong>不当导致的问题:<br>1）丢失修改（Lost Update）<br>2）读“脏数据” （dirty read）<br>3）不可重复读（Non-repeatable Read）</p>
<p><strong>锁类型</strong>有两种：排它锁(Exclusive Locks，简称X锁)和共享锁(Share Locks，简称S锁)。</p>
<p><strong>关系模型的完整性约束</strong>有三类：<code>实体完整性、参照完整性、用户定义的完整性</code>。其中实体完整性和参照完整性是关系模型必须满足的，是关系的不变性。用户定义的完整性是用户自己定义的语义约束。</p>
<ul>
<li>实体完整性（Entity Integrity）：主码（主键）不可为空。</li>
<li>参照完整性（Reference Integrity）: 外码（外键）存在时不可为空</li>
<li>用户定义完整性（User-defined Integrity），这就很自由了，比如某公司员工表中，老板可以自己定义一个规则“性别只能是女……(+_+)? ”  用户定义完整性主要包括：<strong>NOT NULL、UNIQUE、CHECK</strong> 短语。</li>
</ul>
<p><strong>笛卡尔积</strong>（Cartesian Product），是域上面的一种集合运算。<br>　关系（Relation），是笛卡尔积的有限子集，所以也是一张二维表。表示为R（D1，D2，…，Dn）。 </p>
<p>查询操作可分为：选择（Select）、投影（Project）、连接（Join）、除（Divide）、并（Union）、差（Except）、交（Intersection）、笛卡尔积。 </p>
<p>推荐笔记：<a href="http://blog.csdn.net/credolhcw/article/category/6696437" target="_blank" rel="noopener">http://blog.csdn.net/credolhcw/article/category/6696437</a></p>
<h2 id="数据库语言SQL"><a href="#数据库语言SQL" class="headerlink" title="数据库语言SQL:"></a>数据库语言SQL:</h2><p>SQL语言可以分出数据定义语言（DDL）和数据操纵语言（DML），其中DDL用来定义数据库模式，DML用来表达数据库的查询和更新。<br>SQL语法快速参考：<a href="http://blog.csdn.net/hcbbt/article/details/18159933" target="_blank" rel="noopener">http://blog.csdn.net/hcbbt/article/details/18159933</a>  <a href="http://blog.csdn.net/credolhcw/article/details/56484898" target="_blank" rel="noopener">http://blog.csdn.net/credolhcw/article/details/56484898</a><br>SQL的动词：<br>　　数据查询：SELECT<br>　　数据定义：CREATE、DROP、ALTER<br>　　数据操纵：INSERT、UPDATE、DELETE<br>　　数据控制：GRANT、REVOKE</p>
<p>小例子：以MySQL为例<br>1、schema/database定义:CREATE SCHEMA &lt;模式名&gt; 或 CREATE DATABASE &lt;数据库名&gt;<br>注意：在MySQL中Schema和Database是一个概念，这与其他的DBMS可能会有些区别<br>其余命令:show databases;  show schemas; use your_db_name</p>
<p>2、删除用DROP SCHEMA &lt;模式名&gt; 或 DROP DATABASE &lt;数据库名&gt;</p>
<p>3、表定义：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Student</span><br><span class="line">(</span><br><span class="line">    Sno <span class="built_in">CHAR</span>(<span class="number">9</span>) PRIMARY <span class="keyword">KEY</span>, <span class="comment">/* 定义‘主键’的一种方法 */</span></span><br><span class="line">    Sname <span class="built_in">CHAR</span>(<span class="number">20</span>) <span class="keyword">UNIQUE</span>, <span class="comment">/* Sname 取唯一值 */</span></span><br><span class="line">    Ssex <span class="built_in">CHAR</span>(<span class="number">2</span>),</span><br><span class="line">    Sage <span class="built_in">SMALLINT</span>,</span><br><span class="line">    Sdept <span class="built_in">CHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Course</span><br><span class="line">(</span><br><span class="line">    Cno <span class="built_in">CHAR</span>(<span class="number">4</span>),</span><br><span class="line">    Cname <span class="built_in">CHAR</span>(<span class="number">40</span>),</span><br><span class="line">    Cpno <span class="built_in">CHAR</span>(<span class="number">4</span>),</span><br><span class="line">    Ccredit <span class="built_in">SMALLINT</span>,</span><br><span class="line">    PRIMARY <span class="keyword">KEY</span> (Cno), <span class="comment">/* 定义‘主键’的另一种方法 */</span></span><br><span class="line">    FOREIGN <span class="keyword">KEY</span> (Cpno) <span class="keyword">REFERENCES</span> Course(Cno) <span class="comment">/* 参照完整性约束，参照表和被参照表可以是同一张表 */</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> SC</span><br><span class="line">(</span><br><span class="line">    Sno <span class="built_in">CHAR</span>(<span class="number">9</span>),</span><br><span class="line">    Cno <span class="built_in">CHAR</span>(<span class="number">4</span>),</span><br><span class="line">    Grade <span class="built_in">SMALLINT</span>,</span><br><span class="line"></span><br><span class="line">    PRIMARY <span class="keyword">KEY</span> (Sno,Cno),</span><br><span class="line">    FOREIGN <span class="keyword">KEY</span> (Sno) <span class="keyword">REFERENCES</span> Student(Sno),</span><br><span class="line">    FOREIGN <span class="keyword">KEY</span> (Cno) <span class="keyword">REFERENCES</span> Course(Cno)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 插入记录（属于数据更新部分） */</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Student <span class="keyword">VALUES</span> (<span class="string">'200215121'</span>,<span class="string">'李勇'</span>,<span class="string">'男'</span>,<span class="number">20</span>,<span class="string">'CS'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Student <span class="keyword">VALUES</span> (<span class="string">'200215122'</span>,<span class="string">'刘晨'</span>,<span class="string">'女'</span>,<span class="number">19</span>,<span class="string">'CS'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Student <span class="keyword">VALUES</span> (<span class="string">'200215123'</span>,<span class="string">'王敏'</span>,<span class="string">'女'</span>,<span class="number">18</span>,<span class="string">'MA'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Student <span class="keyword">VALUES</span> (<span class="string">'200215125'</span>,<span class="string">'张立'</span>,<span class="string">'男'</span>,<span class="number">19</span>,<span class="string">'IS'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 因为外键的约束，所以不能按顺序插入 */</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Course <span class="keyword">VALUES</span> (<span class="string">'2'</span>,<span class="string">'数学'</span>,<span class="literal">null</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Course <span class="keyword">VALUES</span> (<span class="string">'6'</span>,<span class="string">'数据处理'</span>,<span class="literal">null</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Course <span class="keyword">VALUES</span> (<span class="string">'4'</span>,<span class="string">'操作系统'</span>,<span class="string">'6'</span>,<span class="number">3</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Course <span class="keyword">VALUES</span> (<span class="string">'7'</span>,<span class="string">'PASCAL语言'</span>,<span class="string">'6'</span>,<span class="number">4</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Course <span class="keyword">VALUES</span> (<span class="string">'5'</span>,<span class="string">'数据结构'</span>,<span class="string">'7'</span>,<span class="number">4</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Course <span class="keyword">VALUES</span> (<span class="string">'1'</span>,<span class="string">'数据库'</span>,<span class="string">'5'</span>,<span class="number">4</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Course <span class="keyword">VALUES</span> (<span class="string">'3'</span>,<span class="string">'信息系统'</span>,<span class="string">'1'</span>,<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SC(Sno,Cno,Grade) <span class="keyword">VALUES</span> (<span class="string">'200215121'</span>,<span class="string">'1'</span>,<span class="number">92</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SC(Sno,Cno,Grade) <span class="keyword">VALUES</span> (<span class="string">'200215121'</span>,<span class="string">'2'</span>,<span class="number">85</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SC(Sno,Cno,Grade) <span class="keyword">VALUES</span> (<span class="string">'200215121'</span>,<span class="string">'3'</span>,<span class="number">88</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SC(Sno,Cno,Grade) <span class="keyword">VALUES</span> (<span class="string">'200215122'</span>,<span class="string">'2'</span>,<span class="number">90</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SC(Sno,Cno,Grade) <span class="keyword">VALUES</span> (<span class="string">'200215122'</span>,<span class="string">'3'</span>,<span class="number">80</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 增加Sentrance列 */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> student <span class="keyword">ADD</span> Sentrance <span class="built_in">DATE</span>;</span><br><span class="line"><span class="comment">/* 删除Sentrance列 */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> student <span class="keyword">DROP</span> Sentrance;</span><br><span class="line"><span class="comment">/*修改列名或類型*/</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> student <span class="keyword">CHANGE</span> Sage Sage <span class="built_in">Integer</span>;或者<span class="keyword">ALTER</span> <span class="keyword">TABLE</span> student <span class="keyword">MODIFY</span> Sage <span class="built_in">SMALLINT</span>;</span><br><span class="line">desc student;</span><br><span class="line"><span class="comment">/*约束条件*/</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Course <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span>(Cname);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Course <span class="keyword">DROP</span> <span class="keyword">KEY</span> Cname;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*复制表*/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> sub_SC <span class="keyword">LIKE</span> SC; <span class="comment">/* 按照SC的表结构建立新表sub_SC */</span></span><br><span class="line"><span class="comment">/* 将SC内所有记录插入新表 */</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> sub_SC <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> SC;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*外键约束*/</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> sub_SC <span class="keyword">ADD</span> FOREIGN <span class="keyword">KEY</span> (Sno) <span class="keyword">REFERENCES</span> student(Sno);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> sub_SC <span class="keyword">ADD</span> FOREIGN <span class="keyword">KEY</span> (Cno) <span class="keyword">REFERENCES</span> course(Cno);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*删除表*/</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> &lt;表名&gt; [ RESTRICT | <span class="keyword">CASCADE</span> ] <span class="keyword">ON</span> &lt;表名&gt;（&lt;列名&gt;,…）</span><br><span class="line"></span><br><span class="line"><span class="comment">/*索引*/</span></span><br><span class="line"><span class="keyword">CREATE</span> [<span class="keyword">UNIQUE</span> | FULLTEXT | SPATIAL] <span class="keyword">INDEX</span> &lt;索引名&gt; </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> index_hash_sno <span class="keyword">ON</span> student(Sno) <span class="keyword">USING</span> <span class="keyword">HASH</span>;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">INDEX</span> index_hash_sno <span class="keyword">ON</span> student;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*查询*/</span></span><br><span class="line"><span class="keyword">SELECT</span> [ ALL | <span class="keyword">DISTINCT</span> ] &lt; 目标列表达式 &gt; [ 别名 ]，… </span><br><span class="line"><span class="keyword">FROM</span> &lt; 表名或视图名 &gt; [ 别名 ]，… </span><br><span class="line">[ <span class="keyword">WHERE</span> &lt; 条件表达式 &gt; ] </span><br><span class="line">[ <span class="keyword">GROUP</span> <span class="keyword">BY</span> &lt; 列名 &gt; [ <span class="keyword">HAVING</span> &lt; 条件表达式 &gt; ] ] </span><br><span class="line">[ <span class="keyword">ORDER</span> <span class="keyword">BY</span> &lt; 列名 &gt; [ <span class="keyword">ASC</span> | <span class="keyword">DESC</span> ] ] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span>(Sno) <span class="keyword">FROM</span> SC;</span><br><span class="line"><span class="keyword">SELECT</span> Sname,Ssex <span class="keyword">FROM</span> Student <span class="keyword">WHERE</span> Sdept <span class="keyword">IN</span> (<span class="string">'CS'</span>,<span class="string">'MA'</span>,<span class="string">'IS'</span>);</span><br><span class="line"><span class="comment">/*字符匹配：“[ NOT ] LIKE ‘&lt;匹配串&gt;’ [ ESCAPE ‘&lt;定义转义字符&gt;’]” “%”表示任意长度的字符串。“_”（下划线），表示任意的单个字符。</span></span><br><span class="line"><span class="comment">涉及空值的查询：“IS [ NOT ] NULL”</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> Cno,<span class="keyword">COUNT</span>(Sno) <span class="keyword">FROM</span> SC <span class="keyword">GROUP</span> <span class="keyword">BY</span> Cno;</span><br><span class="line"><span class="keyword">SELECT</span> Sno,Sname,Sdept</span><br><span class="line"><span class="keyword">FROM</span> Student</span><br><span class="line"><span class="keyword">WHERE</span> Sdept <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> Sdept</span><br><span class="line">    <span class="keyword">FROM</span> Student</span><br><span class="line">    <span class="keyword">WHERE</span> Sname = <span class="string">'刘晨'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> Sno,Cno</span><br><span class="line"><span class="keyword">FROM</span> SC x</span><br><span class="line"><span class="keyword">WHERE</span> Grade &gt;= (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">AVG</span>(Grade)</span><br><span class="line">    <span class="keyword">FROM</span> SC y</span><br><span class="line">    <span class="keyword">WHERE</span> y.Sno = x.Sno );</span><br><span class="line"></span><br><span class="line"><span class="comment">/*更新*/</span></span><br><span class="line"><span class="keyword">UPDATE</span> &lt;表名&gt; <span class="keyword">SET</span> &lt;列名&gt; = &lt;表达式&gt; [ ,&lt;列名&gt; = &lt;表达式&gt; ,&lt;列名&gt; = &lt;表达式&gt; ,…] [ <span class="keyword">WHERE</span> &lt;条件&gt; ];</span><br><span class="line"><span class="keyword">UPDATE</span> Student <span class="keyword">SET</span> Sage = <span class="number">22</span> <span class="keyword">WHERE</span> Sno = <span class="string">'200215121'</span>;</span><br><span class="line"><span class="comment">/*删除*/</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> Student <span class="keyword">WHERE</span> Sno = <span class="string">'200215128'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*视图，</span></span><br><span class="line"><span class="comment">由于视图并不是表，所以对其进行的更新操作同样会经过视图消解转化成对基本表的操作。</span></span><br><span class="line"><span class="comment">另外，为了避免用户对视图进行更新操作时，更新了不属于视图范围内的数据，故强烈推荐在视图定义时加上“WITH CHECK OPTION”。*/</span></span><br><span class="line"><span class="keyword">CREATE</span> [ <span class="keyword">OR</span> <span class="keyword">REPLACE</span> ] <span class="keyword">VIEW</span> &lt;视图名&gt; [ ( &lt;列名&gt;, &lt;列名&gt;, … ) ] <span class="keyword">AS</span> &lt;子查询&gt; [ <span class="keyword">WITH</span> <span class="keyword">CHECK</span> <span class="keyword">OPTION</span> ]</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> IS_Student <span class="keyword">AS</span> <span class="keyword">SELECT</span> Sno,Sname,Sage <span class="keyword">FROM</span> Student <span class="keyword">WHERE</span> Sdept = <span class="string">'IS'</span>;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> BT_S,IS_S2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*用户操作*/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">'credo'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'credo'</span>;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> <span class="string">'credo'</span>@<span class="string">'localhost'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> &lt;权限&gt;  <span class="keyword">ON</span> &lt;对象类型&gt;  <span class="keyword">TO</span> &lt;用户&gt; ;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> credo.* <span class="keyword">TO</span> <span class="string">'credo'</span>@<span class="string">'localhost'</span></span><br><span class="line"><span class="keyword">REVOKE</span>&lt;权限&gt; <span class="keyword">ON</span> &lt;对象类型&gt; <span class="keyword">FROM</span> &lt;用户&gt; ;</span><br><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> credo.* <span class="keyword">FROM</span> <span class="string">'credo'</span>@<span class="string">'localhost'</span>;</span><br></pre></td></tr></table></figure></p>
<p><strong>数据类型</strong>：<br>MySQL数据类型：<a href="https://dev.mysql.com/doc/refman/5.7/en/data-type-overview.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/5.7/en/data-type-overview.html</a><br>这里推荐一篇博客：<a href="https://www.cnblogs.com/zbseoag/archive/2013/03/19/2970004.html" target="_blank" rel="noopener">https://www.cnblogs.com/zbseoag/archive/2013/03/19/2970004.html</a></p>
<p>1、数值类型：<br>数据类型 字节数<br>tinyint   1<br>smallint  2<br>mediumint 3<br>int       4<br>bigint    8  </p>
<p>数据类型        字节数<br>float(m,d)      8   m总个数，d小数位<br>double(m,d)     16<br>decimal(m,d)</p>
<p>2、字符串<br>数据类型    字符数<br>char(n)     固定长度255<br>varchar(n)  固定长度65535<br>tinytext 可变长度，255<br>text     可变长度, 65535<br>mediumtext  可变长度2的24次方-1<br>longtext    可变长度,2的32方-1</p>
<p>char和varchar：<br>1.char(n) 若存入字符数小于n，则以空格补于其后，查询之时再将空格去掉。所以char类型存储的字符串末尾不能有空格，varchar不限于此。<br>2.varchar(n) 固定长度，char(4)不管是存入几个字符，都将占用4个字节，varchar是存入的实际字符数+1个字节（n&lt;=255）或2个字节(n&gt;255)，所以varchar(4),存入3个字符将占用4个字节。<br>3.char类型的字符串检索速度要比varchar类型的快。</p>
<p>varchar和text：<br>1.varchar可指定n，text不能指定，内部存储varchar是存入的实际字符数+1个字节（n&lt;=255）或2个字节(n&gt;255)，text是实际字符数+2个字节。<br>2.text类型不能有默认值。<br>3.varchar可直接创建索引，text创建索引要指定前多少个字符。varchar查询速度快于text,在都创建索引的情况下，text的索引似乎不起作用。</p>
<p>3、二进制数据(blob)<br>4、日期时间类型<br>数据类型    含义<br>date        日期’2008-12-2’<br>time        时间’12:25:36’<br>datetime    日期时间’2008-12-2 22:06:44’<br>timestamp   自动存储记录修改时间      </p>
<p>5、数据类型的属性：<br>MySQL关键字    含义<br>NULL    数据列可包含NULL值<br>NOT NULL    数据列不允许包含NULL值<br>DEFAULT    默认值<br>PRIMARY KEY    主键<br>AUTO_INCREMENT    自动递增，适用于整数类型<br>UNSIGNED    无符号<br>CHARACTER SET name    指定一个字符集</p>
<p>约束定义：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Student</span><br><span class="line">(</span><br><span class="line">    Sno <span class="built_in">CHAR</span>(<span class="number">9</span>) PRIMARY <span class="keyword">KEY</span>, <span class="comment">/* 定义‘主键’的一种方法 */</span></span><br><span class="line">    Sname <span class="built_in">CHAR</span>(<span class="number">20</span>) <span class="keyword">UNIQUE</span>, <span class="comment">/* Sname 取唯一值 */</span></span><br><span class="line">    Ssex <span class="built_in">CHAR</span>(<span class="number">2</span>),</span><br><span class="line">    Sage <span class="built_in">SMALLINT</span>,</span><br><span class="line">    Sdept <span class="built_in">CHAR</span>(<span class="number">20</span>),</span><br><span class="line">    <span class="keyword">CHECK</span> ( Ssex <span class="keyword">IN</span> (<span class="string">'男'</span>,<span class="string">'女'</span>) ) <span class="comment">/* 限制属性Ssex只能是‘男’或者 ‘女’ */</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Student</span><br><span class="line">(</span><br><span class="line">    Sno <span class="built_in">CHAR</span>(<span class="number">9</span>) PRIMARY <span class="keyword">KEY</span>, <span class="comment">/* 定义‘主键’的一种方法 */</span></span><br><span class="line">    Sname <span class="built_in">CHAR</span>(<span class="number">20</span>) <span class="keyword">UNIQUE</span>, <span class="comment">/* Sname 取唯一值 */</span></span><br><span class="line">    Ssex <span class="built_in">CHAR</span>(<span class="number">2</span>) <span class="keyword">CHECK</span> ( Ssex <span class="keyword">IN</span> (<span class="string">'男'</span>,<span class="string">'女'</span>) ), <span class="comment">/* 限制属性Ssex只能是‘男’或者 ‘女’ */</span></span><br><span class="line">    Sage <span class="built_in">SMALLINT</span>,</span><br><span class="line">    Sdept <span class="built_in">CHAR</span>(<span class="number">20</span>),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> C1 <span class="keyword">CHECK</span> ( Ssex = <span class="string">'女'</span> <span class="keyword">OR</span> Sname <span class="keyword">NOT</span> <span class="keyword">LIKE</span> <span class="string">'Ms.%'</span> ) <span class="comment">/* 当学生性别是‘男’时，其名字不能以‘Ms.’开头，并将此限制命名为C1 */</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p>触发器（Trigger）:<br>这个Trigger很灵活，比FOREIGN KEY、CHECK什么的加起来还要灵活。</p>
<p>SQL语句格式：<br>CREATE TRIGGER &lt;触发器名&gt; { BEFORE | AFTER } &lt;触发事件&gt; ON &lt;表名&gt; FOR EACH { ROW | STATEMENT }<br>&lt;触发动作体&gt;</p>
<p>相关要求&amp;说明：<br>①、同一模式下，触发器名必须唯一，并且触发器名必须和表名在同一个模式下。<br>②、不能在临时表或试图上创建触发器。<br>③、同一张表上有多个触发器时，若没有定义执行顺序，则按照建立的先后顺序触发。<br>④、触发动作体既可以是一个PL/SQL过程块，也可以是存储过程的调用。<br>⑤、只有行级触发器（FOR EACH ROW），才能用NEW和OLD表示更新前后的值。<br>⑥、触发事件（INSERT | DELETE | UPDATE）并不是仅只执行这三种操作时才会触发，以“INSERT”为例，当执行“LOAD DATA”时，同样是向表中插入新数据，也会触发。</p>
<h2 id="事务与隔离级别"><a href="#事务与隔离级别" class="headerlink" title="事务与隔离级别"></a>事务与隔离级别</h2><p>推荐：<a href="https://www.cnblogs.com/xwdreamer/archive/2011/01/18/2297042.html" target="_blank" rel="noopener">https://www.cnblogs.com/xwdreamer/archive/2011/01/18/2297042.html</a><br><a href="https://www.cnblogs.com/wuyun-blog/p/6241294.html" target="_blank" rel="noopener">https://www.cnblogs.com/wuyun-blog/p/6241294.html</a><br><strong>事务并发控制</strong>：多个事务同时访问数据库时候，会发生下列5类问题，包括3类数据读问题（脏读，不可重复读，幻读），2类数据更新问题（第一类丢失更新，第二类丢失更新）。</p>
<p>由事务隔离性引发几种问题 ？<br>脏读、 不可重复读 、虚读 、 丢失更新</p>
<ul>
<li>脏读： 一个事务读取到另一个事务的<strong>未提交</strong>数据，如果B事务回滚，那么A事务读到的数据根本不是合法的，称为脏读。</li>
<li>不可重复读： 一个事务中，先后读取两次，两次读取结果不同，A事务读取了B事务<strong>已经提交的更改（或删除）</strong>数据。</li>
<li>幻读： 一个事务，先后读取两次，结果不同。A事务读取了B事务已经提交的<strong>新增</strong>数据。</li>
<li>丢失更新： 使用<strong>悲观锁和乐观锁</strong>处理,悲观锁性能太差,建议使用乐观锁<br>第一类丢失更新：A事务撤销时，把已提交的B事务的数据覆盖掉。这种错误会造成非常严重的后果。<br>第二类丢失更新：A事务提交时，把已提交的B事务的数据覆盖掉。这种错误会造成非常严重的后果。</li>
</ul>
<p>不可重复读与幻读的区别：<br>这两种情况对策是不一样的，对于不可重复读，只需要采取<strong>行级锁</strong>防止该记录数据被更改或删除，然而对于幻读必须加<strong>表级锁</strong>，防止在这个表中新增一条数据。</p>
<p><strong>隔离级别</strong><br>READ_UNCOMMITTED：允许你读取还未提交的改变了的数据。可能导致脏、幻、不可重复读。这是因为在Read Uncommitted级别下，读取数据不需要加S锁，这样就不会跟被修改的数据上的X锁冲突。比如，事务1修改一行，事务2在事务1提交之前读取了这一行。如果事务1回滚，事务2就读取了一行没有提交的数据，这样的数据我们认为是不存在的。</p>
<p>READ_COMMITTED：允许在并发事务已经提交后读取。可防止脏读，但幻读和不可重复读仍可发生。<br>该级别通过指定语句不能读取其他事务已修改但是尚未提交的数据值，禁止执行脏读。在当前事务中的各个语句执行之间，其他事务仍可以修改、插入或删除数据，从而产生无法重复的读操作，或“影子”数据。比如，事务1读取了一行，事务2修改或者删除这一行并且提交。如果事务1想再一次读取这一行，它将获得修改后的数据或者发现这一样已经被删除，因此事务的第二次读取结果与第一次读取结果不同，因此也叫不可重复读。</p>
<p>REPEATABLE_READ：对相同字段的多次读取是一致的，除非数据被事务本身改变。可防止脏、不可重复读，但幻读仍可能发生。该级别包括READ COMMITTED，并且另外指定了在当前事务提交之前，其他任何事务均不可以修改或删除当前事务已读取的数据。并发性低于 READ COMMITTED，因为已读数据的共享锁在整个事务期间持有，而不是在每个语句结束时释放。</p>
<p>SERIALIZABLE：完全服从ACID的隔离级别，确保不发生脏、幻、不可重复读。这在所有的隔离级别中是最慢的，它是典型的通过完全锁定在事务中涉及的数据表来完成的。该级别锁定整个范围的键，并一直持有锁，直到事务完成。该级别包括REPEATABLE READ，并增加了在事务完成之前，其他事务不能向事务已读取的范围插入新行的限制。</p>
<p>重复读与幻读<br>重复读是为了保证在一个事务中，相同查询条件下读取的数据值不发生改变，但是不能保证下次同样条件查询，结果记录数不会增加。<br>幻读就是为了解决这个问题而存在的，他将这个查询范围都加锁了，所以就不能再往这个范围内插入数据，这就是SERIALIZABLE 隔离级别做的事情。</p>
<p>事务的隔离级别,是由数据库提供的 ，并不是所有数据库都支持四种隔离级别</p>
<ul>
<li>MySQL : READ_UNCOMMITTED、READ_COMMITTED、REPEATABLE_READ、SERIALIZABLE （默认 REPEATABLE_READ）</li>
<li>Oracle ： READ_UNCOMMITTED、READ_COMMITTED、 SERIALIZABLE（默认 READ_COMMITTED ）<br>查看MySQL的事务隔离级别：默认、全局和会话事务隔离级别：<br>SELECT @@tx_isolation;<br>SELECT @@global.tx_isolation;<br>SELECT @@session.tx_isolation;</li>
</ul>
<p>数据库事务并发问题—解决措施：锁机制–4种隔离级别<br>基本的封锁类型有两种: 排它锁(Exclusive locks 简记为X锁) 和 共享锁(Share locks 简记为S锁)。<br>数据库中为了实现并发控制而采用封锁技术。<br>排它锁又称为写锁。若事务T对数据对象A加上X锁，则只允许T读取和修改A，其它任何事务都不能再对A加任何类型的锁，直到T释放A上的锁。这就保证了其它事务在T释放A上的锁之前不能再读取和修改A。<br>共享锁又称为读锁。若事务T对数据对象A加上S锁，则事务T可以读A但不能修改A，其它事务只能再对A加S锁，而不能加X锁，直到T释放A上的S锁。这就保证了其它事务可以读A，但在T释放A上的S锁之前不能对A做任何修改。</p>
<p>封锁对象的大小称为<strong>封锁粒度</strong>（Granularity）。<br>封锁的对象可以是逻辑单元，也可以是物理单元。以关系数据库为例子，封锁对象可以是这样一些逻辑单元：属性值、属性值的集合、元组、关系、索引项、整个索引项直至整个数据库；也可以是这样的一些物理单元：页（数据页或索引页）、物理记录等。<br><strong>封锁协议</strong>与隔离级别<br>在运用 排他锁 和 共享锁 对数据对象加锁时，还需要约定一些规则，例如何时申请 排他锁 或 共享锁、持锁时间、何时释放等。称这些规则为封锁协议（Locking Protocol）。对封锁方式规定不同的规则，就形成了各种不同的封锁协议。不同的封锁协议对应不同的隔离级别。 </p>
<h3 id="隔离级别与锁的关系"><a href="#隔离级别与锁的关系" class="headerlink" title="隔离级别与锁的关系"></a>隔离级别与锁的关系</h3><ul>
<li>在Read Uncommitted级别下，读操作不加S锁；</li>
<li>在Read Committed级别下，读操作需要加S锁，但是在语句执行完以后释放S锁；</li>
<li>在Repeatable Read级别下，读操作需要加S锁，但是在事务提交之前并不释放S锁，也就是必须等待事务执行完毕以后才释放S锁。</li>
<li>在Serialize级别下，会在Repeatable Read级别的基础上，<strong>添加一个范围锁</strong>。保证一个事务内的两次查询结果完全一样，而不会出现第一次查询结果是第二次查询结果的子集。</li>
</ul>
<p><img src="/img/2018-01-19-18-57-13.png" alt=""></p>
<h3 id="乐观锁和悲观锁的区别"><a href="#乐观锁和悲观锁的区别" class="headerlink" title="乐观锁和悲观锁的区别"></a>乐观锁和悲观锁的区别</h3><p><strong>悲观锁(Pessimistic Lock)</strong>, 顾名思义，就是很悲观，每次去拿数据的时候都认为别人会修改，所以每次在拿数据的时候都会上锁，这样别人想拿这个数据就会block直到它拿到锁。传统的关系型数据库里边就用到了很多这种锁机制，比如<code>行锁，表锁等，读锁，写锁</code>等，都是在做操作之前先上锁。</p>
<p><strong>乐观锁(Optimistic Lock)</strong>, 顾名思义，就是很乐观，每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在更新的时候会判断一下在此期间别人有没有去更新这个数据，可以使用<code>版本号等机制</code>。乐观锁适用于多读的应用类型，这样可以提高吞吐量，像数据库如果提供类似于<code>write_condition</code>机制的其实都是提供的乐观锁。</p>
<p>两种锁各有优缺点，不可认为一种好于另一种，像<strong>乐观锁适用于写比较少的情况下，即冲突真的很少发生的时候</strong>，这样可以省去了锁的开销，加大了系统的整个吞吐量。但<strong>如果经常产生冲突，上层应用会不断的进行retry，这样反倒是降低了性能，所以这种情况下用悲观锁就比较合适。</strong></p>

          
        
      
    </div>
    
    
    
    

 
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xbynet.top/2018/01/17/深入理解计算机系统v3笔记之基础/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xbynet">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://sfault-avatar.b0.upaiyun.com/206/579/2065794108-5721d3ee75b36_huge256">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="倚楼听风雨">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/17/深入理解计算机系统v3笔记之基础/" itemprop="url">深入理解计算机系统v3笔记之基础</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/读书笔记/" itemprop="url" rel="index">
                    <span itemprop="name">读书笔记</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/读书笔记/深入理解计算机系统/" itemprop="url" rel="index">
                    <span itemprop="name">深入理解计算机系统</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/01/17/深入理解计算机系统v3笔记之基础/" class="leancloud_visitors" data-flag-title="深入理解计算机系统v3笔记之基础">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">热度&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  0
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <script src="\assets\js\APlayer.min.js"> </script>
          
        
      
    </div>
    
    
    
    

 
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xbynet.top/2018/01/10/JMS之ActiveMQ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xbynet">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://sfault-avatar.b0.upaiyun.com/206/579/2065794108-5721d3ee75b36_huge256">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="倚楼听风雨">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/10/JMS之ActiveMQ/" itemprop="url">JMS之ActiveMQ</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/中间件/" itemprop="url" rel="index">
                    <span itemprop="name">中间件</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/01/10/JMS之ActiveMQ/" class="leancloud_visitors" data-flag-title="JMS之ActiveMQ">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">热度&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2,777
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  12
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="JMS"><a href="#JMS" class="headerlink" title="JMS"></a>JMS</h1><p>The Java Message Service (JMS) API is a messaging standard that allows application components based on the Java Platform Enterprise Edition (Java EE) to create, send, receive, and read messages. It enables distributed communication that is loosely coupled, reliable, and asynchronous.<br>JMS是java的消息服务，JMS的客户端之间可以通过JMS服务进行异步的消息传输。<br>JMS好处：</p>
<ul>
<li>提供消息灵活性，轻量级通讯机制。</li>
<li>松散耦合</li>
<li>异步性</li>
</ul>
<p>消息模型：<br>○ Point-to-Point(P2P)<br>○ Publish/Subscribe(Pub/Sub)</p>
<p>1、P2P-点对点模型：<br><img src="/img/2018-01-10-17-28-25.png" alt=""><br>涉及角色</p>
<ul>
<li>消息队列（Queue）</li>
<li>发送者(Sender)</li>
<li>接收者(Receiver)<br>每个消息都被发送到一个特定的队列，接收者从队列中获取消息。队列保留着消息，直到他们被消费或超时。</li>
</ul>
<p>P2P特点:<br>每个消息只有一个消费者（Consumer）(即一旦被消费，消息就不再在消息队列中)<br>发送者和接收者之间在时间上没有依赖性<br>接收者在成功接收消息之后需向队列应答成功</p>
<p>2、Pub/Sub模式：<br><img src="/img/2018-01-10-17-31-01.png" alt=""></p>
<ul>
<li>主题（Topic）</li>
<li>发布者（Publisher）</li>
<li>订阅者（Subscriber）<br>多个发布者将消息发送到Topic,系统将这些消息传递给多个订阅者。</li>
</ul>
<p>Pub/Sub特点：<br>每个消息可以有多个消费者<br>发布者和订阅者之间有时间上的依赖性。为了消费消息，订阅者必须保持运行的状态。<br>为了缓和这样严格的时间相关性，JMS允许订阅者创建一个可持久化的订阅。这样，即使订阅者没有被激活（运行），它也能接收到发布者的消息。</p>
<p>消息的消费方式：<br>○ 同步 订阅者或接收者调用receive方法来接收消息，receive方法在能够接收到消息之前（或超时之前）将一直阻塞<br>○ 异步 订阅者或接收者可以注册为一个消息监听器。当消息到达之后，系统自动调用监听器的onMessage方法。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/01/10/JMS之ActiveMQ/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    
    

 
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xbynet.top/2018/01/09/SpringBoot官文笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xbynet">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://sfault-avatar.b0.upaiyun.com/206/579/2065794108-5721d3ee75b36_huge256">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="倚楼听风雨">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/09/SpringBoot官文笔记/" itemprop="url">SpringBoot官文笔记</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/读书笔记/" itemprop="url" rel="index">
                    <span itemprop="name">读书笔记</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/读书笔记/SpringBoot/" itemprop="url" rel="index">
                    <span itemprop="name">SpringBoot</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/01/09/SpringBoot官文笔记/" class="leancloud_visitors" data-flag-title="SpringBoot官文笔记">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">热度&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  6,830
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  35
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p><a href="http://xbynet.top/2017/12/20/%E5%8E%86%E5%8F%B2%E5%8D%9A%E6%96%87%E8%BF%81%E7%A7%BB-Spring-Boot%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">之前关于SpringBoot的文章</a><br>一直没有仔细阅读SpringBoot官文，现补上。虽然2.0已经出了，但还不稳定，现以1.5.9.RELEASE版为基础<br><a href="https://docs.spring.io/spring-boot/docs/1.5.9.RELEASE/reference/htmlsingle/" target="_blank" rel="noopener">https://docs.spring.io/spring-boot/docs/1.5.9.RELEASE/reference/htmlsingle/</a><br>源码：<a href="https://github.com/spring-projects/spring-boot/tree/v1.5.9.RELEASE" target="_blank" rel="noopener">https://github.com/spring-projects/spring-boot/tree/v1.5.9.RELEASE</a><br>APIDOC:<a href="https://docs.spring.io/spring-boot/docs/1.5.9.RELEASE/api/" target="_blank" rel="noopener">https://docs.spring.io/spring-boot/docs/1.5.9.RELEASE/api/</a><br>samples:<a href="https://github.com/spring-projects/spring-boot/tree/v1.5.9.RELEASE/spring-boot-samples/" target="_blank" rel="noopener">https://github.com/spring-projects/spring-boot/tree/v1.5.9.RELEASE/spring-boot-samples/</a></p>
<p>快速创建项目工具(web页面形式)：<a href="https://start.spring.io/" target="_blank" rel="noopener">https://start.spring.io/</a></p>
<h1 id="quickstart"><a href="#quickstart" class="headerlink" title="quickstart"></a>quickstart</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>myproject<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Inherit defaults from Spring Boot --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--默认为1.6，此处该为1.8--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Add typical dependencies for a web application， added Tomcat and Spring MVC--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Package as an executable jar --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>默认是使用spring-boot-starter-parent作为parent,如果你不想这样，你可以如下：<br><a href="https://docs.spring.io/spring-boot/docs/1.5.9.RELEASE/reference/htmlsingle/#using-boot-maven-without-a-parent" target="_blank" rel="noopener">https://docs.spring.io/spring-boot/docs/1.5.9.RELEASE/reference/htmlsingle/#using-boot-maven-without-a-parent</a><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- Import dependency management from Spring Boot --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">     <span class="comment">&lt;!--如果你不想使用spring-boot-starter-parent作为parent,配置&lt;goal&gt;repackage&lt;/goal&gt;是必须的。</span></span><br><span class="line"><span class="comment">     https://docs.spring.io/spring-boot/docs/1.5.9.RELEASE/reference/htmlsingle/#getting-started-first-application-executable-jar</span></span><br><span class="line"><span class="comment">     https://docs.spring.io/spring-boot/docs/1.5.9.RELEASE/maven-plugin/usage.html</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      Package as an executable jar --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>写一段代码试试<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Example</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/"</span>)</span><br><span class="line">    <span class="function">String <span class="title">home</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello World!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        SpringApplication.run(Example.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行：<br>1、直接运行main函数<br>2、mvn spring-boot:run</p>
<p>但继承spring-boot-starter-parent有很多好处，如下：</p>
<ul>
<li>Java 1.6 as the default compiler level.</li>
<li>UTF-8 source encoding.</li>
<li>A Dependency Management section.</li>
<li>Sensible resource filtering.(允许使用pom文件中的project properties变量或直接使用环境变量，在properties文件中通过${..}引用)</li>
<li>Sensible plugin configuration (exec plugin, surefire, Git commit ID, shade).</li>
<li>Sensible resource filtering for application.properties and application.yml including profile-specific files (e.g. application-foo.properties and application-foo.yml)</li>
</ul>
<p>如果你不想使用默认版本的某个依赖，你可以通过properties替换，如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties&gt;</span><br><span class="line">    &lt;spring-data-releasetrain.version&gt;Fowler-SR2&lt;/spring-data-releasetrain.version&gt;</span><br><span class="line">&lt;/properties&gt;</span><br></pre></td></tr></table></figure></p>
<p>关于替换的属性来源，请查看：<a href="https://github.com/spring-projects/spring-boot/blob/v1.5.9.RELEASE/spring-boot-dependencies/pom.xml" target="_blank" rel="noopener">https://github.com/spring-projects/spring-boot/blob/v1.5.9.RELEASE/spring-boot-dependencies/pom.xml</a></p>
<p>但当你没有使用spring-boot-starter-parent作为parent的时候，你需要像下面这样：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--必须置于spring-boot-dependencies前面， Override Spring Data release train provided by Spring Boot --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.data<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-data-releasetrain<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>Fowler-SR2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<hr>
<p>改变Java版本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties&gt;</span><br><span class="line">    &lt;java.version&gt;1.8&lt;/java.version&gt;</span><br><span class="line">&lt;/properties&gt;</span><br></pre></td></tr></table></figure></p>
<p>SpringBoot Starters依赖列表：<a href="https://docs.spring.io/spring-boot/docs/1.5.9.RELEASE/reference/htmlsingle/#using-boot-starter" target="_blank" rel="noopener">https://docs.spring.io/spring-boot/docs/1.5.9.RELEASE/reference/htmlsingle/#using-boot-starter</a></p>
<p>关于Application的注解：@SpringBootApplication包含@EnableAutoConfiguration与@ComponentScan及@Configuration。<br>也就是说下面两种方式是等价的:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>@Configuration可以配置给多个类，@SpringBootApplication或 @EnableAutoConfiguration仅给一个扮演Application的类<br>与@Configuration配合，你还可以使用@Import (class)，@ImportResource (xml)<br>既然SpringBoot会自动配置，那么我们如何查看其自动配置过程呢？使用<code>--debug</code>参数启动即可</p>
<p><a href="https://docs.spring.io/spring-boot/docs/1.5.9.RELEASE/reference/htmlsingle/#using-boot-disabling-specific-auto-configuration" target="_blank" rel="noopener">禁用某些类的自动配置行为</a>：<br>@EnableAutoConfiguration(exclude={DataSourceAutoConfiguration.class})<br>如果类不再路径中<br>@EnableAutoConfiguration(excludeName={“DataSourceAutoConfiguration.class”})<br>当然你也可以通过配置文件直接排除：<br>spring.autoconfigure.exclude=xxx.xxxx.DataSourceAutoConfiguration</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/01/09/SpringBoot官文笔记/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    
    

 
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xbynet.top/2018/01/08/Redis集群方案/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xbynet">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://sfault-avatar.b0.upaiyun.com/206/579/2065794108-5721d3ee75b36_huge256">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="倚楼听风雨">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/08/Redis集群方案/" itemprop="url">Redis集群方案</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/中间件/" itemprop="url" rel="index">
                    <span itemprop="name">中间件</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/中间件/redis/" itemprop="url" rel="index">
                    <span itemprop="name">redis</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/01/08/Redis集群方案/" class="leancloud_visitors" data-flag-title="Redis集群方案">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">热度&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  3,743
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  14
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="知识点回顾"><a href="#知识点回顾" class="headerlink" title="知识点回顾"></a>知识点回顾</h1><p>Redis支持的数据结构</p>
<ul>
<li>字符串（String）</li>
<li>哈希（Hash）</li>
<li>列表（List）</li>
<li>集合（Set）</li>
<li>有序集合（Sorted Set）：支持针对score作范围查询</li>
<li>位数组</li>
<li>HyperLogLog：做基数统计的算法</li>
</ul>
<p>Redis支持的操作</p>
<ul>
<li>基本操作：Set get add push pop…</li>
<li>发布/订阅</li>
<li>Pipeline操作</li>
<li>事务：事务支持不完整。不提供回滚命令。</li>
<li>……</li>
</ul>
<p>Redis适用场景</p>
<ul>
<li>KV存储</li>
<li>缓存（ttl LRU…）：Lru是redis达到maxmemory之后，可选的key删除策略。</li>
<li>消息中间件</li>
<li>分布式锁</li>
<li>……</li>
</ul>
<h1 id="Redis的主从复制"><a href="#Redis的主从复制" class="headerlink" title="Redis的主从复制"></a>Redis的主从复制</h1><p>1.如果设置了一个Slave，无论是第一次连接还是重新连接到Master，它都会发出一个SYNC命令；设置Slave可以是在配置文件添加slaveof 主IP 端口，然后带上配置文件启动server，还可以是启动服务后通过命令的方式设置，<code>slaveof 主IP 端口</code>来实现。<br>2.当Master收到SYNC命令后，会做两件事：<br>a)Master执行BGSAVE，即在后台保存数据到磁盘（rdb快照文件）；是通过子进程进行的<br>b)Master同时将新收到的写入和修改数据集的命令存入缓冲区（非查询类）；<br>3.当Master在后台把数据保存到快照文件完成后，Master会把这个快照文件传送给Slave，而Slave则把内存清空后，加载该文件到内存中；<br>4.而Master也会把此前收集到缓冲区的命令，通过Redis命令协议形式转发给Slave，Slave执行这些命令，实现和Master的同步；<br>5.Master/Slave此后会不断通过异步方式进行命令的同步，达到最终数据的同步一致；</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/01/08/Redis集群方案/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    
    

 
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xbynet.top/2018/01/07/HTTP权威指南笔记之重定向与负载均衡/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xbynet">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://sfault-avatar.b0.upaiyun.com/206/579/2065794108-5721d3ee75b36_huge256">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="倚楼听风雨">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/07/HTTP权威指南笔记之重定向与负载均衡/" itemprop="url">HTTP权威指南笔记之重定向与负载均衡</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/读书笔记/" itemprop="url" rel="index">
                    <span itemprop="name">读书笔记</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/读书笔记/HTTP权威指南/" itemprop="url" rel="index">
                    <span itemprop="name">HTTP权威指南</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/01/07/HTTP权威指南笔记之重定向与负载均衡/" class="leancloud_visitors" data-flag-title="HTTP权威指南笔记之重定向与负载均衡">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">热度&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1,267
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  4
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <script src="\assets\js\APlayer.min.js"> </script><p>重定向技术:<br>HTTP重定向<br>DNS重定向<br>任播路由<br>策略路由<br>IP MAC转发<br>IP地址转发<br>WCCP(Web缓存协调协议)<br>ICP(缓存间通信协议)<br>HTCP(超文本缓存协议)<br>NECP(网元控制协议)<br>CARP(缓存阵列路由协议)<br>WPAD(Web代理自动发现协议)</p>
<p>为什么要重定向：可靠地执行HTTP事务、最小化时延、节约网络带宽、对服务器进行负载均衡<br><img src="/img/2018-01-07-16-10-56.png" alt=""><br><img src="/img/2018-01-07-16-11-25.png" alt=""><br><img src="/img/2018-01-07-16-12-03.png" alt=""><br><img src="/img/2018-01-07-16-12-25.png" alt=""><br>DNS轮转，DNS缓存。由于进行DNS查询一般会比较耗时，所以一般会进行DNS缓存，由于DNS缓存的存在，对于单个客户端而言每次请求的都是同一个ip，但是对于所有客户端而言，由于DNS轮转的存在，可以实现服务器的负载均衡。<br><img src="/img/2018-01-07-16-15-39.png" alt=""></p>
<h1 id="IP-MAC转发："><a href="#IP-MAC转发：" class="headerlink" title="IP MAC转发："></a>IP MAC转发：</h1><p>在以太网中，HTTP报文都是以携带地址的数据分组的形式发送的。每个分组都有一个第四层地址，由源IP地址，目的IP地址以及TCP端口号组成,它是第四层设备所关注的地址。每个分组还有一个第二层地址，MAC(Media Access Control)地址，这是第二层设备(通常是交换机和Hub)所关注的地址。第二层设备的任务是接收具有特定输入MAC地址的分组，然后将其转发到特定的输出MAC地址上去。<br><img src="/img/2018-01-07-16-19-41.png" alt=""><br><img src="/img/2018-01-07-16-20-32.png" alt=""></p>
<p>注意：由于MAC地址转发只是点对点的，所以服务器或代理只能位于离交换机一跳远的地方。</p>
<h1 id="IP地址转发："><a href="#IP地址转发：" class="headerlink" title="IP地址转发："></a>IP地址转发：</h1><p>在IP地址转发中，交换机或其他第四层设备会检测输入分组的TCP/IP地址，并通过修改目的IP地址,对分组进行相应的转发。与MAC转发相比，这么做的优点是目标服务器不需要位于一跳远的地方，只需要位于交换机的上游就行。这种类型的转发也被称为<code>NAT</code>(Network Address Translation,网络地址转换)。<br><code>对称路由</code>的问题：从客户端接受输入TCP连接的交换机管理着连接，交换机必须通过那条TCP连接将响应回送给客户端。这样，所有来自目标服务器或代理的响应都必须返回给交换机。<br><img src="/img/2018-01-07-16-26-39.png" alt=""><br>有以下两种方式可以控制响应的返回路径：<br>1、将分组的源IP地址改成交换机的IP地址。通过这种方式，无论交换机和服务器之间采用何种网络配置，响应分组都会被发送给交换机。这种方式被称为<code>完全NAT(full NAT)</code>,其中的IP转发设备会对目的IP地址和源IP地址都进行转换。缺点：服务器不知道客户端的IP地址。<br><img src="/img/2018-01-07-16-30-53.png" alt=""><br>2、如果源IP地址仍然是客户端的IP地址，就要确保(从硬件角度)没有从服务器到客户端的直接路由(绕过交换机的)。这种方式被称为<code>半NAT(half NAT)</code>。缺点：要对客户端和服务器之间的整个网络都有某种程度的控制。</p>
<h1 id="NECP-网元控制协议"><a href="#NECP-网元控制协议" class="headerlink" title="NECP-网元控制协议"></a>NECP-网元控制协议</h1><p>NECP(Network Element Control Protocol)允许网元(NE,路由器和交换机等负责转发IP分组的设备)与服务器元素(SE,Web服务器和代理缓存等提供应用层请求的设备)进行交互。NECP并未显式提供对负载均衡的支持，它只是为SE提供了一种发送负载均衡信息给NE的方式，这样NE就可以在它认为合适的情况下进行负载均衡了。转发分组的方式：MAC转发，GRE封装，NAT。<br>NECP报文：略。</p>
<h1 id="代理的重定向"><a href="#代理的重定向" class="headerlink" title="代理的重定向"></a>代理的重定向</h1><p>略</p>
<h1 id="缓存重定向"><a href="#缓存重定向" class="headerlink" title="缓存重定向"></a>缓存重定向</h1><p>WCCP重定向：可以使路由器将Web流量重定向到代理缓存中去。</p>
<h1 id="因特网缓存协议-TCP"><a href="#因特网缓存协议-TCP" class="headerlink" title="因特网缓存协议-TCP"></a>因特网缓存协议-TCP</h1><p>ICP允许缓存在其兄弟中查找命中内容。如果某个缓存中没有HTTP报文所请求的内容，它可以查明内容是否在附近的兄弟缓存中，如果在，就从那里获取内容，以避免查询原始服务器而带来的更多开销。可以把ICP当作一个缓存集群协议。<br><img src="/img/2018-01-07-18-24-15.png" alt=""></p>
<h1 id="CARP-缓存阵列路由协议"><a href="#CARP-缓存阵列路由协议" class="headerlink" title="CARP-缓存阵列路由协议"></a>CARP-缓存阵列路由协议</h1><p>随着用户数的增加，大量流量可能会使代理服务器自身超载，对此，一种解决方案就是使用多个代理服务器将负载分散到一组服务器上。CARP就是这样一种协议来管理一组代理服务器。CARP是ICP的一个替代品。<br><img src="/img/2018-01-07-18-24-55.png" alt=""></p>
<h1 id="HTCP-超文本缓存协议"><a href="#HTCP-超文本缓存协议" class="headerlink" title="HTCP-超文本缓存协议"></a>HTCP-超文本缓存协议</h1><p>HTCP允许兄弟缓存之间通过URL和所有的请求及响应头部来相互查询文档是否存在，以降低错误命中的可能。同时还允许兄弟缓存监听或请求在对方的缓存中添加或删除所选中的文档，并修改对方已缓存文档的缓存策略。</p>

          
        
      
    </div>
    
    
    
    

 
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xbynet.top/2018/01/07/HTTP权威指南笔记之识别-认证-安全/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xbynet">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://sfault-avatar.b0.upaiyun.com/206/579/2065794108-5721d3ee75b36_huge256">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="倚楼听风雨">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/07/HTTP权威指南笔记之识别-认证-安全/" itemprop="url">HTTP权威指南笔记之识别-认证-安全</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/读书笔记/" itemprop="url" rel="index">
                    <span itemprop="name">读书笔记</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/读书笔记/HTTP权威指南/" itemprop="url" rel="index">
                    <span itemprop="name">HTTP权威指南</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/01/07/HTTP权威指南笔记之识别-认证-安全/" class="leancloud_visitors" data-flag-title="HTTP权威指南笔记之识别-认证-安全">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">热度&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  34
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <script src="\assets\js\APlayer.min.js"> </script><p>承载用户信息的HTTP首部：<br>From  用户的e-mail地址<br>User-Agent<br>Referer<br>Authorization 用户名和密码<br>Client-IP<br>X-Forwarded-For<br>Cookie</p>
<p><img src="/img/2018-01-07-14-55-11.png" alt=""><br><img src="/img/2018-01-07-14-55-48.png" alt=""><br><img src="/img/2018-01-07-14-56-54.png" alt=""><br><img src="/img/2018-01-07-15-00-24.png" alt=""><br><img src="/img/2018-01-07-15-01-06.png" alt=""></p>

          
        
      
    </div>
    
    
    
    

 
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xbynet.top/2018/01/05/tomcat8-5官文笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xbynet">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://sfault-avatar.b0.upaiyun.com/206/579/2065794108-5721d3ee75b36_huge256">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="倚楼听风雨">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/05/tomcat8-5官文笔记/" itemprop="url">tomcat8.5官文笔记</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/中间件/" itemprop="url" rel="index">
                    <span itemprop="name">中间件</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/中间件/tomcat/" itemprop="url" rel="index">
                    <span itemprop="name">tomcat</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/01/05/tomcat8-5官文笔记/" class="leancloud_visitors" data-flag-title="tomcat8.5官文笔记">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">热度&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  4,691
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  21
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>一直没有通读过很多中间件的官方文档，这次恶补起来。<br><a href="http://tomcat.apache.org/tomcat-8.5-doc/index.html" target="_blank" rel="noopener">http://tomcat.apache.org/tomcat-8.5-doc/index.html</a><br>tomcat还在维护的有几个版本9.0,8.5,8.0,7.0<br>其中9.0实现了Servlet4.0规范(JavaEE8),8.5实现了Servlet3.1规范(JavaEE7),并移除BIO连接器，默认采用NIO连接器，8.0也实现了Servlet3.1规范,7.0实现了Servlet3.0规范(JavaEE 6)。<br>区别，可参考：<a href="https://www.zhihu.com/question/52255668" target="_blank" rel="noopener">https://www.zhihu.com/question/52255668</a><br>其实8.5之所以会出现，就是想在8.0与9.0之间有个稳定的新功能过度，而且8.5支持Http/2</p>
<p>关于怎么选择，及Servelt不同版本的区别，见:<a href="http://tomcat.apache.org/whichversion.html" target="_blank" rel="noopener">http://tomcat.apache.org/whichversion.html</a><br><img src="/img/2018-01-05-09-41-47.png" alt=""><br>不同Servlet版本的功能区别:<a href="https://en.wikipedia.org/wiki/Java_servlet#History" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Java_servlet#History</a><br><img src="/img/2018-01-05-09-44-06.png" alt=""></p>
<p>更多参考:<br><a href="http://www.infoq.com/cn/news/2015/04/burns-servlet-http2" target="_blank" rel="noopener">Servlet4.0新特性概览</a><br><a href="http://jinnianshilongnian.iteye.com/blog/1912455" target="_blank" rel="noopener">Servlet3.1新特性概览</a><br><a href="https://www.ibm.com/developerworks/cn/java/j-lo-servlet30/" target="_blank" rel="noopener">Servlet3.0新特性概览</a></p>
<p>相关规范查找地址:<a href="https://wiki.apache.org/tomcat/Specifications" target="_blank" rel="noopener">https://wiki.apache.org/tomcat/Specifications</a></p>
<p>本笔记选择阅读8.5的文档，毕竟9.0要应用到生成环境还需一两年，而8.5比较文档，还支持部分JavaEE8中的新特性，如Http/2的支持。</p>
<p>一些核心概念：<br>1、<code>Context</code>:一个Context代表一个Wen应用<br>2、<code>$CATALINA_HOME与$CATALINA_BASE</code>:CATALINA_HOME是Tomcat的安装目录，CATALINA_BASE是Tomcat的工作目录。如果不显式指定CATALINA_BASE，那么默认和CATALINA_HOME路径一致，这篇文章说的不错:<a href="http://blog.csdn.net/jiaotuwoaini/article/details/51455829" target="_blank" rel="noopener">http://blog.csdn.net/jiaotuwoaini/article/details/51455829</a></p>
<p>APIDOC:<br><a href="http://tomcat.apache.org/tomcat-8.5-doc/api/index.html" target="_blank" rel="noopener">http://tomcat.apache.org/tomcat-8.5-doc/api/index.html</a><br><a href="http://tomcat.apache.org/tomcat-8.5-doc/servletapi/index.html" target="_blank" rel="noopener">http://tomcat.apache.org/tomcat-8.5-doc/servletapi/index.html</a><br><a href="http://tomcat.apache.org/tomcat-8.5-doc/jspapi/index.html" target="_blank" rel="noopener">http://tomcat.apache.org/tomcat-8.5-doc/jspapi/index.html</a><br><a href="http://tomcat.apache.org/tomcat-8.5-doc/websocketapi/index.html" target="_blank" rel="noopener">http://tomcat.apache.org/tomcat-8.5-doc/websocketapi/index.html</a></p>
<p>tomcat源码:<a href="http://tomcat.apache.org/svn.html" target="_blank" rel="noopener">http://tomcat.apache.org/svn.html</a><br>svncheck地址:<a href="http://svn.apache.org/repos/asf/tomcat/tc8.5.x/trunk/" target="_blank" rel="noopener">http://svn.apache.org/repos/asf/tomcat/tc8.5.x/trunk/</a><br>git地址:git://git.apache.org/tomcat85.git</p>
<p>tomcat升级迁移指南：<a href="http://tomcat.apache.org/migration.html" target="_blank" rel="noopener">http://tomcat.apache.org/migration.html</a><br><a href="http://tomcat.apache.org/migration-85.html" target="_blank" rel="noopener">http://tomcat.apache.org/migration-85.html</a></p>
<p>JSP talibs下载：<a href="https://tomcat.apache.org/download-taglibs.cgi" target="_blank" rel="noopener">https://tomcat.apache.org/download-taglibs.cgi</a></p>
<p>架构图：<br><img src="/img/2018-01-05-17-19-50.png" alt=""><br><img src="/img/2018-01-17-11-29-25.png" alt=""><br><img src="/img/2018-01-05-17-20-47.png" alt=""><br><img src="/img/2018-01-17-11-29-56.png" alt=""><br><img src="/img/2018-01-05-16-45-49.png" alt=""><br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/01/05/tomcat8-5官文笔记/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    
    

 
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xbynet.top/2018/01/02/HTTP权威指南笔记之Web服务器-代理-缓存/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xbynet">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://sfault-avatar.b0.upaiyun.com/206/579/2065794108-5721d3ee75b36_huge256">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="倚楼听风雨">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/02/HTTP权威指南笔记之Web服务器-代理-缓存/" itemprop="url">HTTP权威指南笔记之Web服务器、代理、缓存</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/读书笔记/" itemprop="url" rel="index">
                    <span itemprop="name">读书笔记</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/读书笔记/HTTP权威指南/" itemprop="url" rel="index">
                    <span itemprop="name">HTTP权威指南</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/01/02/HTTP权威指南笔记之Web服务器-代理-缓存/" class="leancloud_visitors" data-flag-title="HTTP权威指南笔记之Web服务器、代理、缓存">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">热度&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1,322
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  5
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="web服务器"><a href="#web服务器" class="headerlink" title="web服务器"></a>web服务器</h2><p><img src="/img/2018-01-02-20-36-57.png" alt=""></p>
<p>1、接受客户端连接<br>如果已经有持久连接，则重用，如果没有，客户端需要打开一条新的到服务器的连接。<br>需要注意的是 <strong>处理新连接时，服务器会对客户端主机名进行识别，通过dns查询。但是DNS查询很费时间，所以一般会选择禁用它，比如tomcat配置时最好禁用dns查询</strong></p>
<p>2、接受请求报文<br>接受请求报文，将请求报文解析为内部表示形式，连接输入/输出处理结构<br><img src="/img/2018-01-02-20-42-09.png" alt=""><br>web服务器接受请求的形式：</p>
<ul>
<li>单线程BIO</li>
<li>BIO+多线程/进程</li>
<li>复用IO即NIO</li>
<li>NIO+多线程/多进程<br><img src="/img/2018-01-02-20-43-55.png" alt=""></li>
</ul>
<p>3、处理请求<br>4、对资源的映射及访问<br>docroot,动态内容<br><img src="/img/2018-01-02-20-45-11.png" alt=""><br>cgi、ssi、访问控制</p>
<p>5、构建响应<br>响应报文一般包括:Content-Type，Content-Length,主体内容<br>重定向可用于的场景:永久删除，临时删除，URL增强，负载均衡，服务器关联，规范目录名称<br>6、发生响应<br>注意正确计算Content-Length头部，否则客户端无法知道响应什么时候结束。<br>7、记录日志。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/01/02/HTTP权威指南笔记之Web服务器-代理-缓存/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    
    

 
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xbynet.top/2018/01/02/Kubernetes笔记之基本概念/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xbynet">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://sfault-avatar.b0.upaiyun.com/206/579/2065794108-5721d3ee75b36_huge256">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="倚楼听风雨">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/02/Kubernetes笔记之基本概念/" itemprop="url">Kubernetes笔记之基本概念</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/读书笔记/" itemprop="url" rel="index">
                    <span itemprop="name">读书笔记</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/读书笔记/kubernetes/" itemprop="url" rel="index">
                    <span itemprop="name">kubernetes</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/01/02/Kubernetes笔记之基本概念/" class="leancloud_visitors" data-flag-title="Kubernetes笔记之基本概念">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">热度&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  5,589
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  20
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>本系列K8s读书笔记基于开源的<a href="https://rootsongjc.gitbooks.io/kubernetes-handbook/content/" target="_blank" rel="noopener">kubernetes-handbook</a>书籍</p>
<p>Kubernetes(k8s)是Google基于Borg开源的容器编排调度引擎，作为<code>CNCF</code>（Cloud Native Computing Foundation）最重要的组件之一，它的目标不仅仅是一个编排系统，而是提供一个规范，可以让你来<strong>描述集群的架构，定义服务的最终状态，kubernetes可以帮你将系统自动得达到和维持在这个状态</strong>。Kubernetes作为云原生应用的基石，相当于一个云操作系统.<br>Kubernetes用户可以通过编写一个yaml或者json格式的配置文件，也可以通过工具/代码生成或直接请求kubernetes API创建应用，该配置文件中包含了<code>用户想要应用程序保持的状态</code>，不论整个kubernetes集群中的个别主机发生什么问题，<code>都不会影响应用程序的状态</code>，你还可以通过改变该配置文件或请求kubernetes API来<code>改变应用程序的状态</code>。<br><img src="/img/2018-01-02-10-42-02.png" alt=""><br><img src="/img/2018-01-02-10-43-39.png" alt=""><br><img src="/img/2018-01-02-10-45-26.png" alt=""><br><img src="/img/2018-01-02-10-46-47.png" alt=""><br><img src="/img/2018-01-02-10-48-36.png" alt=""><br><img src="/img/2018-01-02-10-48-57.png" alt=""><br><img src="/img/2018-01-02-10-49-18.png" alt=""><br><img src="/img/2018-01-02-10-51-01.png" alt=""><br><img src="/img/2018-01-02-10-51-33.png" alt=""></p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/01/02/Kubernetes笔记之基本概念/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    
    

 
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://sfault-avatar.b0.upaiyun.com/206/579/2065794108-5721d3ee75b36_huge256"
                alt="xbynet" />
            
              <p class="site-author-name" itemprop="name">xbynet</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">40</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">20</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">34</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/xbynet" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:xbynet@outlook.com" target="_blank" title="E-Mail">
                    
                      <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            
          </div>

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友情链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.xby1993.net/index.html" title="旧博客笔记" target="_blank">旧博客笔记</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://segmentfault.com/blog/xbynet" title="Segmentfault旧博文" target="_blank">Segmentfault旧博文</a>
                  </li>
                
              </ul>
            </div>
          

          <div id="aplayer1" class="aplayer"></div>
<script src="/asserts/js/APlayer.min.js"></script>
<script>
    var musiclist=[
        {title:'素雨',author:'孙雪宁',url:'http://ws.stream.qqmusic.qq.com/C1000040LV2h3FzIVl.m4a?fromtag=38',pic:'https://y.gtimg.cn/music/photo_new/T002R300x300M000003mxnKZ0WbTPc.jpg?max_age=2592000'},
        {title:'爱在上',author:'崔子格',url:'http://dl.stream.qqmusic.qq.com/M8000019Hx0J3tqcaV.mp3?vkey=93EB395793C648848684E76AE3B2D6E08F9EC8C7412B177750792C7CEC73BDC4FD06C1F78C02D9186339549C042F2CA5955914BA8322F6E4&guid=5150825362&fromtag=1',pic:'https://y.gtimg.cn/music/photo_new/T002R300x300M000003ksYhQ1EmEcr.jpg?max_age=2592000'}
    ]
    var tmpindex=Math.floor(Math.random()*musiclist.length);
    var music=musiclist[tmpindex];
    var ap = new APlayer({
        element: document.getElementById('aplayer1'),
        narrow: false,
        autoplay: false,
        showlrc: false,
        mutex: true,
        theme: '#e6d0b2',
        preload: 'metadata',
        mode: 'circulation',
        music: {
            title: music.title,
            author: music.author,
            url: music.url,
            pic: music.pic
        }
    });
</script>

<!-- 
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=28815250&auto=0&height=66"></iframe>
-->
        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xbynet</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">191.1k</span>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  




  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("sHIc70OVniNsR5OI1atIhMuk-gzGzoHsz", "wt266j1nbmoGAFrXdwXt7TeS");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  
  <script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.3"></script>
  <script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.3"></script>


  


  <a href="https://github.com/xbynet"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://camo.githubusercontent.com/567c3a48d796e2fc06ea80409cc9dd82bf714434/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_left_darkblue_121621.png"></a>

<script>

$(document).ready(function() {
//修复toc无法点击的问题
    $(".nav-item .nav-link").each(function(i){
              $(this).text($(this).attr("href").replace('#',''));
              $(this).parent().contents().filter(function() {
                  return this.nodeType == 3; //Node.TEXT_NODE
              }).remove();
            });
//主页阴影
      if(true){
            $('.post').addClass('post-index');
        }
    });
</script>
  
</body>
</html>
